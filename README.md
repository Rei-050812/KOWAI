# KOWAI - AIæ€ªè«‡ç”Ÿæˆã‚µã‚¤ãƒˆ

<div align="center">

**ãŸã£ãŸä¸€ã¤ã®å˜èªã‹ã‚‰ã€AIãŒæœ¬æ ¼çš„ãªæ€ªè«‡ã‚’ç”Ÿæˆ**

[![Next.js](https://img.shields.io/badge/Next.js-16.1.4-black?style=flat-square&logo=next.js)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.9.3-blue?style=flat-square&logo=typescript)](https://www.typescriptlang.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind_CSS-4.1.18-38B2AC?style=flat-square&logo=tailwind-css)](https://tailwindcss.com/)
[![Claude AI](https://img.shields.io/badge/Claude_AI-Sonnet_4.5-orange?style=flat-square)](https://www.anthropic.com/)

[ãƒ‡ãƒ¢ã‚’è¦‹ã‚‹](#) | [æ©Ÿèƒ½](#æ©Ÿèƒ½) | [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)

</div>

## ğŸ“– æ¦‚è¦

KOWAIã¯ã€Claude AIã‚’æ´»ç”¨ã—ãŸæ¬¡ä¸–ä»£ã®æ€ªè«‡ç”Ÿæˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸä¸€ã¤ã®å˜èªã‹ã‚‰ã€**Blueprinté§†å‹•RAGã‚·ã‚¹ãƒ†ãƒ **ã¨ã€Œæ´’è½æ€–ã€ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åŸºã¥ã„ã¦æœ¬æ ¼çš„ãªæ€ªè«‡ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

### âœ¨ ç‰¹å¾´

- ğŸ§  **Blueprinté§†å‹•RAGã‚·ã‚¹ãƒ†ãƒ **
  - æ€ªè«‡ã®æ§‹é€ ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã€ŒKaidanBlueprintã€ã¨ã—ã¦è“„ç©
  - æ–‡ä½“ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã€ŒStyleBlueprintã€ã¨ã—ã¦è“„ç©ï¼ˆèªã‚Šå£ãƒ»æ„Ÿæƒ…ãƒ¬ãƒ™ãƒ«ãƒ»ç¦æ­¢äº‹é …ç­‰ï¼‰
  - ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹æ¤œç´¢ã«ã‚ˆã‚‹é«˜é€Ÿãƒãƒƒãƒãƒ³ã‚°
  - å“è³ªã‚¹ã‚³ã‚¢ã«ã‚ˆã‚‹éšå±¤çš„æ¤œç´¢ï¼ˆ70ç‚¹â†’50ç‚¹â†’30ç‚¹â†’ãƒ©ãƒ³ãƒ€ãƒ â†’æ±ç”¨ï¼‰
  - ç”Ÿæˆã—ãŸæ€ªè«‡ã«blueprint_idã‚’è¨˜éŒ²ï¼ˆè¿½è·¡å¯èƒ½ï¼‰
  - çµ±åˆç®¡ç†ç”»é¢ã‹ã‚‰æ§‹é€ ãƒ»æ–‡ä½“ã‚’ä¸€æ‹¬ç™»éŒ²
  - æœ¬æ–‡ã‚³ãƒ”ãƒšã‹ã‚‰æ§‹é€ +æ–‡ä½“ã‚’åŒæ™‚è‡ªå‹•æŠ½å‡º
  - Blueprintä¸€æ‹¬æ­£è¦åŒ–API

- ğŸ”„ **3ãƒ•ã‚§ãƒ¼ã‚ºç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ **
  - **Phase Aï¼ˆopeningï¼‰**: **æœ€å¤§1æ–‡ã®ã¿**ã€‚æ™‚é–“ãƒ»å ´æ‰€ãƒ»ç«‹å ´ã®äº‹å®Ÿã ã‘ã‚’è¨˜è¿°ï¼ˆæ„Ÿæƒ³ãƒ»äºˆå‘Šãƒ»å¿ƒæƒ…ç¦æ­¢ï¼‰
  - **Phase Bï¼ˆdisturbanceï¼‰**: Phase A ã®**ç›´å¾Œã‹ã‚‰ç¶šã**ã€‚å†èª¬æ˜ç¦æ­¢ã€ã€Œå¤‰åŒ–ãƒ»é•å’Œæ„Ÿãƒ»è¡Œå‹•ã€ã§é–‹å§‹
  - **Phase Cï¼ˆclimaxï¼‰**: ä¸å¯é€†ç‚¹ï¼ˆC1ï¼‰+ çŸ­ã„ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ï¼ˆC2ï¼‰+ ä½™éŸ»
  - å„ãƒ•ã‚§ãƒ¼ã‚ºã§ãƒªãƒˆãƒ©ã‚¤ä»˜ããƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœ€å¤§2å›ï¼‰
  - **Phase A / B å¢ƒç•Œã®å®Œå…¨å›ºå®š**: å†’é ­é‡è¤‡ãƒ»çŠ¶æ³èª¬æ˜ã®è¨€ã„ç›´ã—ã‚’é˜²æ­¢

- âœ¨ **å“è³ªæ”¹å–„æ©Ÿèƒ½**
  - **Phase A æ–‡æ•°åˆ¶é™**: æœ€å¤§1æ–‡ã®ã¿è¨±å¯ï¼ˆ2æ–‡ä»¥ä¸Šã¯è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼‰
  - **Phase A ç¦æ­¢èªå¥**: æ„Ÿæƒ³/äºˆå‘Š/æœªæ¥è¦–ç‚¹/ä¸ç©ã•/å¿ƒæƒ…æå†™ã‚’æ¤œå‡ºãƒ»ãƒªãƒˆãƒ©ã‚¤
  - **Phase A/B é¡ä¼¼åˆ¤å®š**: å†’é ­é¡ä¼¼åº¦60%ä»¥ä¸Šã€ç¦æ­¢é–‹å§‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€åŒä¸€ä¸»èªã‚’æ¤œå‡º
  - **é‡è¤‡é™¤å»**: Phaseé–“ã®å†’é ­ãƒ†ã‚­ã‚¹ãƒˆé‡è¤‡ã‚’è‡ªå‹•æ¤œå‡ºãƒ»é™¤å»ï¼ˆå…ˆé ­1æ–‡ã®å®Œå…¨ä¸€è‡´/é«˜é¡ä¼¼åº¦ã‚‚æ¤œå‡ºï¼‰
  - **å¤šæ§˜æ€§ã‚¬ãƒ¼ãƒ‰**: ç›´è¿‘3è©±ã¨é¡ä¼¼è¨­å®š/ã‚­ãƒ£ã‚¹ãƒˆ/å±•é–‹ã‚’å›é¿
  - **èªå½™ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³**: ç›´è¿‘5è©±ã§é »å‡ºã—ãŸèªå½™ï¼ˆæ›œæ—¥ãƒ»å®¶æ—ãƒ»æ™‚é–“å¸¯ãƒ»é“å…·ãƒ»å ´æ‰€ãƒ»æ„Ÿæƒ…è¡¨ç¾ç­‰50ç¨®ä»¥ä¸Šï¼‰ã‚’éæ¨å¥¨ãƒªã‚¹ãƒˆã¨ã—ã¦æ¸¡ã—ã€å¤šæ§˜æ€§ã‚’ç¢ºä¿
  - **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é€£å‘¼é˜²æ­¢**: Phase A=1ã€œ2å›ã€Phase B=æœ€å¤§2å›ã€Phase C=æœ€å¤§1å›ã®åˆ¶é™ã§éå‰°ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä½¿ç”¨ã‚’é˜²æ­¢
  - **ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹æ¤œè¨¼**: ææ€–ãƒ”ãƒ¼ã‚¯èªå½™ãƒ»ä½™éŸ»æ–‡ã®å­˜åœ¨ã‚’ãƒã‚§ãƒƒã‚¯
  - **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸»å½¹åŒ–**: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæ€ªç•°ã®æ ¸ã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã‹æ¤œè¨¼
  - **æœªå®Œã‚»ãƒªãƒ•æ¤œå‡º**: è¨€ã„ã‹ã‘ã®ã‚»ãƒªãƒ•ï¼ˆã€Œâ€¦ã€ã€Œâ€•ã€ã§çµ‚ã‚ã‚‹ï¼‰ã‚’æ¤œå‡º
  - **æ€ªç•°ã‚»ãƒªãƒ•å“è³ªãƒ«ãƒ¼ãƒ«**: é™³è…ãªãƒ›ãƒ©ãƒ¼ã‚»ãƒªãƒ•ï¼ˆã€Œã‚„ã£ã¨å‡ºã‚‰ã‚Œã‚‹ã€ã€Œä¸€ç·’ã«éŠã¼ã†ã€ç­‰ï¼‰ã‚’ç¦æ­¢ã—ã€æ–‡è„ˆã‹ã‚‰æµ®ã„ãŸä¸æ°—å‘³ãªã‚»ãƒªãƒ•ã‚’ç”Ÿæˆ
  - **å°å…¥æ–‡è¢«ã‚Šãƒã‚§ãƒƒã‚¯**: Phase BãŒPhase Aã¨åŒã˜å†’é ­æ–‡å‹ã§å§‹ã¾ã£ã¦ã„ãªã„ã‹æ¤œå‡ºï¼ˆãƒªãƒˆãƒ©ã‚¤ä»˜ãï¼‰
  - **å‡ºæ¥äº‹å†æå†™ãƒã‚§ãƒƒã‚¯**: Phase Aã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’Phase Bã§ç¹°ã‚Šè¿”ã—ã¦ã„ãªã„ã‹æ¤œå‡º
  - **è¡Œå‹•æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯**: åŒæ™‚ã«æˆç«‹ã—ãªã„è¡Œå‹•ï¼ˆé‹è»¢ä¸­ã«åŒçœ¼é¡ç­‰ï¼‰ã‚„å”çªãªé€ƒèµ°ã‚’æ¤œå‡º

- ğŸ‘» **ã€Œæ´’è½æ€–ã€ã‚¹ã‚¿ã‚¤ãƒ«**
  - 2ã¡ã‚ƒã‚“ã­ã‚‹ã‚ªã‚«ãƒ«ãƒˆæ¿ç™ºç¥¥ã®ãƒªã‚¢ãƒªãƒ†ã‚£é‡è¦–ã®æ€ªè«‡
  - ã€Œä¸å¯é€†ã®ç¢ºå®šã€ï¼šå–ã‚Šè¿”ã—ãŒã¤ã‹ãªã„ã¨æ‚Ÿã£ãŸç¬é–“ã‚’æå†™
  - æ€ªç•°ã¯1ç¨®é¡ã®ã¿ã€èª¬æ˜ã¯ä¸€åˆ‡ã—ãªã„
  - æ—¥å¸¸ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«ã®ç©ã¿é‡ã­ã§ä¿¡æ†‘æ€§ã‚’æ‹…ä¿

- ğŸ­ **4ã¤ã®æ€ªè«‡ãƒ‘ã‚¿ãƒ¼ãƒ³**
  - ç›®æ’ƒç³»ï¼šä¸å¯è§£ãªã‚‚ã®ã‚’ç›®æ’ƒã™ã‚‹è¦–è¦šçš„ææ€–
  - å› æœå¿œå ±ç³»ï¼šç¦å¿Œã‚’çŠ¯ã—ã¦å–ã‚Šè¿”ã—ãŒã¤ã‹ãªããªã‚‹
  - ä¼æ‰¿ç³»ï¼šå¤ã„è¨€ã„ä¼ãˆãŒç¾å®Ÿã«ãªã‚‹
  - æ—¥å¸¸å´©å£Šç³»ï¼šæ—¥å¸¸ã®é•å’Œæ„Ÿã‹ã‚‰çœŸå®Ÿã«æ°—ã¥ã

- ğŸ“ **3ã¤ã®ã‚¹ã‚¿ã‚¤ãƒ«**
  - çŸ­ç·¨ï¼ˆç´„500å­—ï¼‰ï¼šã‚µã‚¯ãƒƒã¨èª­ã‚ã‚‹ã€ã‚ªãƒé‡è¦–
  - ä¸­ç·¨ï¼ˆç´„1000å­—ï¼‰ï¼šé›°å›²æ°—ãŒå¾ã€…ã«ç©ã¿é‡ãªã‚‹
  - é•·ç·¨ï¼ˆç´„2000å­—ï¼‰ï¼šæœ¬æ ¼æ€ªè«‡ã€ä¼ç·šã‚„è¤‡æ•°ã®å±•é–‹

- ğŸ² **ãŠã¾ã‹ã›ãƒ¢ãƒ¼ãƒ‰**
  - å˜èªã‚’å…¥åŠ›ã›ãšã«æ€ªè«‡ã‚’ç”Ÿæˆå¯èƒ½
  - ãƒ©ãƒ³ãƒ€ãƒ ãªBlueprintã‚’è‡ªå‹•é¸æŠã—ã¦ç”Ÿæˆ

- ğŸ¨ **æ–‡å­¦çš„ãªãƒ‡ã‚¶ã‚¤ãƒ³**
  - æ˜æœä½“ï¼ˆNoto Serif JPï¼‰ã‚’ä½¿ç”¨ã—ãŸé«˜ç´šæ„Ÿã®ã‚ã‚‹UI
  - æ·±ã„é»’ï¼ˆ#0A0A0Aï¼‰ã¨ã‚ªãƒ•ãƒ›ãƒ¯ã‚¤ãƒˆï¼ˆ#E8E6E3ï¼‰ã®æ´—ç·´ã•ã‚ŒãŸé…è‰²
  - ç´™ã®ã‚ˆã†ãªãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨èµ¤ã„ã‚°ãƒ­ãƒ¼åŠ¹æœ

- ğŸ“Š **ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½**
  - æœ€æ–°ã®æ€ªè«‡
  - äººæ°—ã®æ€ªè«‡ï¼ˆã„ã„ã­æ•°é †ï¼‰
  - äººæ°—ã®å˜èª

## ğŸ›  æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Next.js 16.1.4** - React ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆTurbopackï¼‰
- **TypeScript 5.9.3** - å‹å®‰å…¨ãªé–‹ç™º
- **Tailwind CSS 4.1.18** - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆCSS

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Next.js API Routes** - ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰API
- **Claude AI (Anthropic)** - æ€ªè«‡ç”ŸæˆAI
  - Model: `claude-sonnet-4-20250514`
- **Supabase** - PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

### ãã®ä»–
- **React 19.2.3** - UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **PostCSS** - CSSå‡¦ç†

## ğŸ“¦ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Node.js 18.x ä»¥ä¸Š
- npm ã¾ãŸã¯ yarn
- Anthropic API Key
- Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/Rei-050812/KOWAI.git
cd KOWAI
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ä½œæˆï¼š

```env
# Anthropic API Key
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# ç®¡ç†ç”»é¢ã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
ADMIN_TOKEN=your_admin_token_here
```

#### APIã‚­ãƒ¼ã®å–å¾—æ–¹æ³•

**Anthropic API Key:**
1. https://console.anthropic.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
3. API Keys ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰æ–°ã—ã„ã‚­ãƒ¼ã‚’ä½œæˆ

**Supabase:**
1. https://supabase.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
3. Settings â†’ API ã‹ã‚‰ URL ã¨ anon key ã‚’å–å¾—

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Supabase SQL Editor ã§ä»¥ä¸‹ã®SQLã‚’å®Ÿè¡Œï¼š

```sql
-- stories ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
CREATE TABLE stories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  word TEXT NOT NULL,
  style TEXT NOT NULL CHECK (style IN ('short', 'medium', 'long')),
  title TEXT NOT NULL,
  hook TEXT NOT NULL,
  story TEXT NOT NULL,
  likes INTEGER DEFAULT 0,
  views INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- word_counts ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
CREATE TABLE word_counts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  word TEXT UNIQUE NOT NULL,
  count INTEGER DEFAULT 1,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆ
CREATE INDEX idx_stories_created_at ON stories(created_at DESC);
CREATE INDEX idx_stories_likes ON stories(likes DESC);
CREATE INDEX idx_word_counts_count ON word_counts(count DESC);

-- word_usage_logs ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—ç”¨ï¼‰
CREATE TABLE word_usage_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  word TEXT NOT NULL,
  story_id UUID REFERENCES stories(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_word_usage_logs_word ON word_usage_logs(word);
CREATE INDEX idx_word_usage_logs_created_at ON word_usage_logs(created_at DESC);
```

#### Blueprint RAGã‚·ã‚¹ãƒ†ãƒ ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
-- kaidan_blueprints ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
CREATE TABLE kaidan_blueprints (
  id SERIAL PRIMARY KEY,
  title TEXT NOT NULL,
  tags TEXT[] NOT NULL DEFAULT '{}',
  blueprint JSONB NOT NULL,
  quality_score INTEGER NOT NULL DEFAULT 50 CHECK (quality_score >= 0 AND quality_score <= 100),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆ
CREATE INDEX idx_blueprints_tags ON kaidan_blueprints USING GIN (tags);
CREATE INDEX idx_blueprints_quality ON kaidan_blueprints(quality_score DESC);
CREATE INDEX idx_blueprints_created_at ON kaidan_blueprints(created_at DESC);

-- ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹æ¤œç´¢RPC
CREATE OR REPLACE FUNCTION match_blueprints_by_keyword(
  query_keyword TEXT,
  match_count INT DEFAULT 3,
  min_quality INT DEFAULT 50
)
RETURNS TABLE (
  id INT,
  title TEXT,
  blueprint JSONB,
  tags TEXT[],
  quality_score INT,
  similarity FLOAT
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT
    kb.id,
    kb.title,
    kb.blueprint,
    kb.tags,
    kb.quality_score,
    1.0::FLOAT AS similarity
  FROM kaidan_blueprints kb
  WHERE
    kb.quality_score >= min_quality
    AND EXISTS (
      SELECT 1 FROM unnest(kb.tags) AS tag
      WHERE tag ILIKE '%' || query_keyword || '%'
         OR query_keyword ILIKE '%' || tag || '%'
    )
  ORDER BY kb.quality_score DESC
  LIMIT match_count;
END;
$$;

-- ãƒ©ãƒ³ãƒ€ãƒ Blueprintå–å¾—RPC
CREATE OR REPLACE FUNCTION get_random_blueprint(min_quality INT DEFAULT 50)
RETURNS TABLE (
  id INT,
  title TEXT,
  blueprint JSONB,
  tags TEXT[],
  quality_score INT,
  similarity FLOAT
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT
    kb.id,
    kb.title,
    kb.blueprint,
    kb.tags,
    kb.quality_score,
    0.0::FLOAT AS similarity
  FROM kaidan_blueprints kb
  WHERE kb.quality_score >= min_quality
  ORDER BY RANDOM()
  LIMIT 1;
END;
$$;

-- storiesãƒ†ãƒ¼ãƒ–ãƒ«ã«blueprint_idè¿½åŠ ï¼ˆç”Ÿæˆè¿½è·¡ç”¨ï¼‰
ALTER TABLE stories
ADD COLUMN IF NOT EXISTS blueprint_id INTEGER REFERENCES kaidan_blueprints(id) ON DELETE SET NULL;

CREATE INDEX IF NOT EXISTS idx_stories_blueprint_id ON stories(blueprint_id);
```

### 5. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã‚’é–‹ãã¾ã™ã€‚

## ğŸš€ ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰

```bash
npm run build
npm start
```

### Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/Rei-050812/KOWAI)

1. Vercelã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
4. ãƒ‡ãƒ—ãƒ­ã‚¤

## ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
KOWAI/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/               # API Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ generate/     # æ€ªè«‡ç”ŸæˆAPIï¼ˆè²¬å‹™åˆ†é›¢æ¸ˆã¿ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ blueprints/   # Blueprint API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ save/      # Blueprintä¿å­˜
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ search/    # Blueprintæ¤œç´¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ extract/   # æœ¬æ–‡â†’Blueprint+StyleBlueprintæŠ½å‡º
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ normalize/ # Blueprintä¸€æ‹¬æ­£è¦åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/        # ç®¡ç†è€…ç”¨API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ blueprints/    # KaidanBlueprint CRUD
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ style-blueprints/ # StyleBlueprint CRUD
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dashboard/     # çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰API
â”‚   â”‚   â”‚   â”œâ”€â”€ ranking/      # ãƒ©ãƒ³ã‚­ãƒ³ã‚°API
â”‚   â”‚   â”‚   â””â”€â”€ stories/      # ã‚¹ãƒˆãƒ¼ãƒªãƒ¼API
â”‚   â”‚   â”œâ”€â”€ admin/            # ç®¡ç†ç”»é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ AdminAuthContext.tsx  # èªè¨¼çŠ¶æ…‹ã®å…±æœ‰Context
â”‚   â”‚   â”‚   â”œâ”€â”€ blueprints/  # Blueprintçµ±åˆç®¡ç†ï¼ˆæ§‹é€ /æ–‡ä½“/æ–°è¦ç™»éŒ²ã‚¿ãƒ–ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ingest/  # æœ¬æ–‡â†’æ§‹é€ +æ–‡ä½“ã®åŒæ™‚æŠ½å‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/   # çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”‚   â””â”€â”€ reviews/     # ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ story/[id]/       # æ€ªè«‡è©³ç´°ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ ranking/          # ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ layout.tsx        # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ page.tsx          # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”‚   â””â”€â”€ globals.css       # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”œâ”€â”€ components/            # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ StoryGenerator.tsx  # æ€ªè«‡ç”Ÿæˆãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â”‚   â”œâ”€â”€ StoryDisplay.tsx    # æ€ªè«‡è¡¨ç¤º
â”‚   â”‚   â””â”€â”€ RankingPreview.tsx  # ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
â”‚   â”œâ”€â”€ lib/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ prompts.ts          # AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šç¾©ï¼ˆ3ãƒ•ã‚§ãƒ¼ã‚ºå¯¾å¿œãƒ»StyleBlueprintæ³¨å…¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ supabase.ts         # Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆBlueprint/StyleBlueprintå¯¾å¿œï¼‰
â”‚   â”‚   â”œâ”€â”€ blueprint-scoring.ts # Blueprintå“è³ªæ¡ç‚¹ï¼ˆå…±é€šãƒ­ã‚¸ãƒƒã‚¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ style-validators.ts  # StyleBlueprintãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ validators.ts       # ç”Ÿæˆãƒ†ã‚­ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœªå®Œã‚»ãƒªãƒ•æ¤œå‡ºç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ dedupe.ts           # Phaseé–“é‡è¤‡é™¤å»
â”‚   â”‚   â”œâ”€â”€ diversity.ts        # å¤šæ§˜æ€§ã‚¬ãƒ¼ãƒ‰ï¼ˆé¡ä¼¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å›é¿ï¼‰
â”‚   â”‚   â””â”€â”€ generic-blueprint.ts # æ±ç”¨Blueprintãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
â”‚   â”œâ”€â”€ hooks/                 # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ useTypingEffect.ts # ã‚¿ã‚¤ãƒ”ãƒ³ã‚°æ¼”å‡º
â”‚   â””â”€â”€ types/                 # TypeScriptå‹å®šç¾©ï¼ˆBlueprintå‹å«ã‚€ï¼‰
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ migrations/           # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚       â”œâ”€â”€ 001_kaidan_blueprints.sql
â”‚       â”œâ”€â”€ 002_add_blueprint_id_to_stories.sql  # Blueprintè¿½è·¡ç”¨
â”‚       â”œâ”€â”€ 003_generation_logs.sql              # ç”Ÿæˆãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«
â”‚       â”œâ”€â”€ 004_validation_stats.sql             # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµ±è¨ˆ
â”‚       â”œâ”€â”€ 005_quality_improvements.sql         # å“è³ªæ”¹å–„ã‚«ãƒ©ãƒ è¿½åŠ 
â”‚       â”œâ”€â”€ 006_keyword_focus.sql                # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸»å½¹åŒ–ãƒã‚§ãƒƒã‚¯
â”‚       â”œâ”€â”€ 007_story_reviews.sql                # ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
â”‚       â”œâ”€â”€ 008_admin_views.sql                  # ç®¡ç†ç”¨ãƒ“ãƒ¥ãƒ¼
â”‚       â”œâ”€â”€ 009_review_functions.sql             # ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨RPC
â”‚       â”œâ”€â”€ 010_style_blueprints.sql             # StyleBlueprintãƒ†ãƒ¼ãƒ–ãƒ«+åˆæœŸãƒ‡ãƒ¼ã‚¿
â”‚       â””â”€â”€ 011_unify_admin_queue_columns.sql    # ç®¡ç†ãƒ“ãƒ¥ãƒ¼çµ±ä¸€
â”œâ”€â”€ public/                    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ .env.local.example        # ç’°å¢ƒå¤‰æ•°ã®ã‚µãƒ³ãƒ—ãƒ«
â”œâ”€â”€ next.config.ts            # Next.jsè¨­å®š
â”œâ”€â”€ tailwind.config.ts        # Tailwind CSSè¨­å®š
â”œâ”€â”€ tsconfig.json             # TypeScriptè¨­å®š
â””â”€â”€ package.json
```

## ğŸ§  Blueprint RAGã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

Blueprintã¯æ€ªè«‡ã®ã€Œæ§‹é€ çš„ãªæ€–ã•ã®è¨­è¨ˆå›³ã€ã§ã™ã€‚å…¥åŠ›ã•ã‚ŒãŸå˜èªã«å¿œã˜ã¦é©åˆ‡ãªBlueprintã‚’æ¤œç´¢ã—ã€ãã‚Œã‚’å…ƒã«æ€ªè«‡ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

### Blueprintã®æ§‹é€ 

```json
{
  "anomaly": "æ€ªç•°ã®æ ¸ï¼ˆ1ã¤ã ã‘ï¼‰",
  "normal_rule": "é€šå¸¸æ™‚ã®å‰æãƒ»æ—¥å¸¸ã®ãƒ«ãƒ¼ãƒ«",
  "irreversible_point": "ä¸å¯é€†ã®ç¢ºå®šç‚¹",
  "reader_understands": "èª­è€…ãŒç†è§£ã§ãã‚‹ã“ã¨",
  "reader_cannot_understand": "èª­è€…ãŒç†è§£ã§ããªã„ã“ã¨",
  "constraints": {
    "no_explanations": true,
    "single_anomaly_only": true,
    "no_emotion_words": true,
    "no_clean_resolution": true,
    "daily_details_min": 3
  },
  "allowed_subgenres": ["ç›®æ’ƒç³»", "ä¼æ‰¿ç³»"],
  "detail_bank": ["æ—¥å¸¸ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«ã®ãƒªã‚¹ãƒˆ"],
  "ending_style": "çµæœ«ã®ã‚¹ã‚¿ã‚¤ãƒ«"
}
```

### å“è³ªè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ¸›ç‚¹æ–¹å¼ãƒ»100ç‚¹æº€ç‚¹ï¼‰

`src/lib/blueprint-scoring.ts` ã§ä¸€å…ƒç®¡ç†ã€‚ãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å…±é€šãƒ­ã‚¸ãƒƒã‚¯ã€‚

| é•åé …ç›® | æ¸›ç‚¹ | é‡å¤§åº¦ | èª¬æ˜ |
|---------|------|--------|------|
| anomalyæœªè¨­å®š/çŸ­ã™ã | -30 | error | æ€ªç•°ã®æ ¸ãŒ5æ–‡å­—æœªæº€ |
| single_anomaly_only=false | -30 | error | å¿…é ˆåˆ¶ç´„é•å |
| irreversible_pointæœªè¨­å®š | -25 | error | ä¸å¯é€†ã®ç¢ºå®šç‚¹ãŒ5æ–‡å­—æœªæº€ |
| normal_ruleæœªè¨­å®š | -20 | error | é€šå¸¸æ™‚ã®å‰æãŒ5æ–‡å­—æœªæº€ |
| no_explanations=false | -10 | warning | èª¬æ˜ç¦æ­¢ãŒç„¡åŠ¹ |
| reader_understandsæœªè¨­å®š | -5 | warning | èª­è€…ç†è§£ãŒæœªè¨­å®š |
| reader_cannot_understandæœªè¨­å®š | -5 | warning | èª­è€…ä¸ç†è§£ãŒæœªè¨­å®š |
| ending_styleæœªè¨­å®š | -5 | warning | çµæœ«ã‚¹ã‚¿ã‚¤ãƒ«æœªè¨­å®š |
| detail_bank < 3 | -3 | warning | æ—¥å¸¸ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«ä¸è¶³ |
| allowed_subgenresç©º | -2 | warning | ã‚µãƒ–ã‚¸ãƒ£ãƒ³ãƒ«æœªè¨­å®š |

### æ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

1. å…¥åŠ›å˜èªã§ã‚¿ã‚°ãƒãƒƒãƒï¼ˆmin_quality: 70ï¼‰
2. ãƒãƒƒãƒãªã— â†’ min_quality: 50ã§å†æ¤œç´¢
3. ãƒãƒƒãƒãªã— â†’ min_quality: 30ã§å†æ¤œç´¢
4. ãƒãƒƒãƒãªã— â†’ ãƒ©ãƒ³ãƒ€ãƒ ã«Blueprintå–å¾—
5. BlueprintãŒ0ä»¶ â†’ å¾“æ¥ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

### ç®¡ç†ç”»é¢

#### èªè¨¼

ç®¡ç†ç”»é¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯ `ADMIN_TOKEN` ã«ã‚ˆã‚‹èªè¨¼ãŒå¿…è¦ã§ã™ã€‚

1. ç®¡ç†ç”»é¢ï¼ˆ`/admin/dashboard` ãªã©ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚µã‚¤ãƒ‰ãƒãƒ¼ä¸Šéƒ¨ã®ã€Œèªè¨¼ãŒå¿…è¦ã§ã™ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. `.env.local` ã«è¨­å®šã—ãŸ `ADMIN_TOKEN` ã‚’å…¥åŠ›
4. èªè¨¼ãŒæˆåŠŸã™ã‚‹ã¨ã€Œèªè¨¼æ¸ˆã¿ã€ã¨è¡¨ç¤ºã•ã‚Œã€å…¨ç®¡ç†ç”»é¢ã§å…±é€šåˆ©ç”¨å¯èƒ½
5. ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚èªè¨¼çŠ¶æ…‹ã¯ç¶­æŒã•ã‚Œã¾ã™ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆã§è§£é™¤ï¼‰

#### Blueprintçµ±åˆç®¡ç†ï¼ˆ`/admin/blueprints`ï¼‰

ã‚¿ãƒ–åˆ‡æ›¿ã§æ§‹é€ ï¼ˆKaidanBlueprintï¼‰ã¨æ–‡ä½“ï¼ˆStyleBlueprintï¼‰ã‚’ä¸€æ‹¬ç®¡ç†ã€‚ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«è‡ªå‹•èª­ã¿è¾¼ã¿ã€‚

- **æ§‹é€ ã‚¿ãƒ–**: KaidanBlueprintä¸€è¦§è¡¨ç¤ºãƒ»å˜ä½“æ–°è¦ç™»éŒ²ãƒ»å‰Šé™¤
- **æ–‡ä½“ã‚¿ãƒ–**: StyleBlueprintä¸€è¦§è¡¨ç¤ºãƒ»ç·¨é›†ãƒ»æœ‰åŠ¹/ç„¡åŠ¹åˆ‡æ›¿ãƒ»å˜ä½“æ–°è¦ç™»éŒ²ãƒ»å‰Šé™¤
  - æµæ´¾åã®é¡ä¼¼ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ï¼ˆæ—¢å­˜ã¨ä¼¼ãŸåå‰ã‚’è‡ªå‹•å›é¿ï¼‰

#### æœ¬æ–‡â†’BlueprintæŠ½å‡ºï¼ˆ`/admin/blueprints/ingest`ï¼‰

- æ€ªè«‡æœ¬æ–‡ã‚’ã‚³ãƒ”ãƒšã™ã‚‹ã ã‘ã§æ§‹é€ ï¼ˆKaidanBlueprintï¼‰ã¨æ–‡ä½“ï¼ˆStyleBlueprintï¼‰ã‚’**åŒæ™‚ã«**è‡ªå‹•æŠ½å‡º
- 10,000æ–‡å­—ä»¥ä¸Šã®é•·æ–‡ã¯è‡ªå‹•åˆ†å‰²å‡¦ç†ï¼ˆæ§‹é€ æŠ½å‡ºï¼‰ã€æ–‡ä½“ã¯ä»£è¡¨ã‚µãƒ³ãƒ—ãƒ«ã§åˆ†æ
- æŠ½å‡ºçµæœã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€**ãã®å ´ã§ç›´æ¥ç™»éŒ²å¯èƒ½**ï¼ˆæ§‹é€ ãƒ»æ–‡ä½“ãã‚Œãã‚Œå€‹åˆ¥ã«ï¼‰
- **é‡è¦**: æœ¬æ–‡ã¯DBã«ä¿å­˜ã•ã‚Œãªã„ï¼ˆè‘—ä½œæ¨©ä¿è­·ï¼‰

#### çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆ`/admin/dashboard`ï¼‰

- ç·ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ•°ï¼ˆä»Šé€±/ä»Šæœˆï¼‰
- å¹³å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼è©•ä¾¡ãƒ»è©•ä¾¡åˆ†å¸ƒ
- KaidanBlueprint/StyleBlueprintã®ç™»éŒ²çŠ¶æ³
- å“è³ªãƒ•ãƒ©ã‚°é›†è¨ˆï¼ˆå‡ºæ¥äº‹é‡è¤‡ãƒ»è¡Œå‹•ä¸æ•´åˆãƒ»å¼•ç”¨ä¸å®Œäº†ãƒ»æ”¯é›¢æ»…è£‚ï¼‰
- ãƒ¬ãƒ“ãƒ¥ãƒ¼å•é¡Œå‚¾å‘
- StyleBlueprintä½¿ç”¨çŠ¶æ³

#### ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†ï¼ˆ`/admin/reviews`ï¼‰

- è‡ªå‹•å“è³ªãƒ•ãƒ©ã‚°ä»˜ãã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚­ãƒ¥ãƒ¼
- 5æ®µéšè©•ä¾¡ + å•é¡Œã‚¿ã‚°ä»˜ã‘
- å„ªå…ˆåº¦è‡ªå‹•è¨ˆç®—ï¼ˆå“è³ªãƒ•ãƒ©ã‚°æ•°ã«å¿œã˜ã¦ï¼‰
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼è©•ä¾¡ãŒStyleBlueprinté¸æŠã«è‡ªå‹•åæ˜ **ï¼ˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—ï¼‰

### StyleBlueprint

StyleBlueprintã¯æ€ªè«‡ã®ã€Œæ›¸ãæ–¹ã®æµæ´¾ã€ã‚’å®šç¾©ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«æŒ‡ç¤ºæ›¸ã§ã™ã€‚KaidanBlueprintãŒã€Œä½•ã‚’æ›¸ãã‹ã€ã‚’å®šç¾©ã™ã‚‹ã®ã«å¯¾ã—ã€StyleBlueprintã¯ã€Œã©ã†æ›¸ãã‹ã€ã‚’å®šç¾©ã—ã¾ã™ã€‚

```json
{
  "archetype_name": "æ·¡ã€…å®ŸéŒ²å‹",
  "tone_features": ["ä½“è¨€æ­¢ã‚å¤šç”¨", "çŸ­æ–‡ä¸»ä½“"],
  "narrator_stance": "distant",
  "emotion_level": 0,
  "sentence_style": "short",
  "onomatopoeia_usage": "minimal",
  "dialogue_style": "functional",
  "style_prohibitions": ["éåº¦ãªæ„Ÿæƒ…è¡¨ç¾", "èª¬æ˜çš„ãªæ€ªç•°æå†™"],
  "sample_phrases": ["ã€œã ã£ãŸã¨æ€ã†", "ã€œãªã®ã ãŒ"]
}
```

- **å…¨ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆA/B/Cï¼‰ã®ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ³¨å…¥**ã•ã‚Œã€å†’é ­ã‹ã‚‰æ–‡ä½“ã®ä¸€è²«æ€§ã‚’ç¢ºä¿
- å“è³ªã‚¹ã‚³ã‚¢ãƒ»ä½¿ç”¨å›æ•°ãƒ»å¹³å‡è©•ä¾¡ã«ã‚ˆã‚‹è‡ªå‹•é¸åˆ¥
- ãƒ¬ãƒ“ãƒ¥ãƒ¼è©•ä¾¡ãŒ `avg_story_rating` ã«è‡ªå‹•é›†è¨ˆã•ã‚Œã€é«˜è©•ä¾¡ã‚¹ã‚¿ã‚¤ãƒ«ãŒå„ªå…ˆé¸æŠã•ã‚Œã‚‹

#### ãƒ¬ãƒ“ãƒ¥ãƒ¼ â†’ ç”Ÿæˆ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—

```
ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”Ÿæˆ â†’ ãƒ¬ãƒ“ãƒ¥ãƒ¼è©•ä¾¡(1-5) + å•é¡Œã‚¿ã‚° â†’ StyleBlueprintã®ã‚¹ã‚³ã‚¢æ›´æ–°
       â†‘                                              â†“
       â† â† â† â† é«˜ã‚¹ã‚³ã‚¢ã‚¹ã‚¿ã‚¤ãƒ«ãŒå„ªå…ˆé¸æŠ â† â† â† â† â†
```

**é¸æŠã‚¹ã‚³ã‚¢è¨ˆç®—å¼ï¼š**
```
ã‚¹ã‚³ã‚¢ = (æœªä½¿ç”¨æœŸé–“ãƒœãƒ¼ãƒŠã‚¹) + (å¹³å‡è©•ä¾¡Ã—10) + (å“è³ªã‚¹ã‚³ã‚¢Ã—0.3)
       - (æ”¯é›¢æ»…è£‚ç‡Ã—25) - (è¡Œå‹•ä¸æ•´åˆç‡Ã—20) - (å‡ºæ¥äº‹å†æå†™ç‡Ã—15)
       - (æœªå®Œã‚»ãƒªãƒ•ç‡Ã—10) - (ãƒ¬ãƒ“ãƒ¥ãƒ¼å•é¡Œç‡Ã—15)
```

- é«˜è©•ä¾¡ãƒ»ä½å•é¡Œã‚¹ã‚¿ã‚¤ãƒ« â†’ é¸æŠã‚¹ã‚³ã‚¢ä¸Šæ˜‡ â†’ ã‚ˆã‚Šå¤šãä½¿ç”¨ã•ã‚Œã‚‹
- ä½è©•ä¾¡ãƒ»é«˜å•é¡Œã‚¹ã‚¿ã‚¤ãƒ« â†’ é¸æŠã‚¹ã‚³ã‚¢ä½ä¸‹ â†’ è‡ªå‹•çš„ã«æ·˜æ±°ã•ã‚Œã‚‹

#### Blueprintæ­£è¦åŒ–APIï¼ˆ`/api/blueprints/normalize`ï¼‰

- GET: ç¾åœ¨ã®BlueprintçŠ¶æ…‹ã‚’ç¢ºèª
- POST: ä¸€æ‹¬æ­£è¦åŒ–ã‚’å®Ÿè¡Œ
  - `daily_details_min` ã‚’ 0/1 ã«çµ±ä¸€
  - `detail_bank` ã‹ã‚‰ä¸é©åˆ‡ãªé …ç›®ã‚’é™¤å»
  - `single_anomaly_only` é•åã‚’æ¤œå‡º
  - å“è³ªã‚¹ã‚³ã‚¢ã‚’å†è¨ˆç®—

## ğŸ”„ 3ãƒ•ã‚§ãƒ¼ã‚ºç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

æ€ªè«‡ã‚’3ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‘ã¦æ®µéšçš„ã«ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã€æ§‹é€ çš„ãªä¸€è²«æ€§ã¨å“è³ªã‚’ç¢ºä¿ã—ã¾ã™ã€‚

### ãƒ•ã‚§ãƒ¼ã‚ºæ§‹æˆ

```
Phase A (opening)     â†’ Phase B (disturbance)  â†’ Phase C (climax)
æ—¥å¸¸ã®å‰æãƒ»çŠ¶æ³æå†™    é•å’Œæ„Ÿãƒ»æ€ªç•°ã®å…†å€™        ä¸å¯é€†ç‚¹ + ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ + ä½™éŸ»
```

### å„ãƒ•ã‚§ãƒ¼ã‚ºã®è©³ç´°

| ãƒ•ã‚§ãƒ¼ã‚º | å½¹å‰² | ä½¿ç”¨ã™ã‚‹Blueprintè¦ç´  | ç¦æ­¢äº‹é … |
|---------|------|---------------------|---------|
| **Phase A** | **1æ–‡ã®ã¿**ã§èˆå°ã‚’è¨­å®šï¼ˆæ™‚é–“ãƒ»å ´æ‰€ãƒ»ç«‹å ´ï¼‰ | `normal_rule` | æ„Ÿæƒ³ã€äºˆå‘Šã€æœªæ¥è¦–ç‚¹ã€ä¸ç©ã•ã€å¿ƒæƒ…æå†™ã€2æ–‡ä»¥ä¸Š |
| **Phase B** | Phase A ã®**ç›´å¾Œã‹ã‚‰**é•å’Œæ„Ÿãƒ»æ€ªç•°ã‚’æå†™ | `anomaly`, `detail_bank` | Phase A ã®å†èª¬æ˜ã€å°å…¥ã®ç¹°ã‚Šè¿”ã—ã€çŠ¶æ…‹å‹•è©ã§ã®é–‹å§‹ |
| **Phase C** | ä¸å¯é€†ç‚¹ â†’ ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ â†’ ä½™éŸ» | `irreversible_point` | è§£æ±ºã€å›åã€å¾Œæ—¥è«‡ |

### Phase A / B å¢ƒç•Œãƒ«ãƒ¼ãƒ«

Phase B ã¯ Phase A ã®ã€Œç¶šãã€ã§ã‚ã‚Šã€ã€Œå†æç¤ºã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

**Phase A OKä¾‹:**
- ã€ŒçœŸæ˜¼ã®çœŒé“ã‚’è»Šã§èµ°ã£ã¦ã„ãŸã€‚ã€
- ã€Œæ–°ã—ãå¼•ã£è¶Šã—ãŸã‚¢ãƒ‘ãƒ¼ãƒˆã§ä¸€äººæš®ã‚‰ã—ã‚’å§‹ã‚ãŸã€‚ã€

**Phase A NGä¾‹:**
- ã€Œã¾ã•ã‹ã‚ã‚“ãªã“ã¨ã«ãªã‚‹ã¨ã¯æ€ã‚ãªã‹ã£ãŸã€‚ã€ï¼ˆäºˆå‘Šï¼‰
- ã€Œã©ã“ã‹é•å’Œæ„Ÿã®ã‚ã‚‹ã‚¢ãƒ‘ãƒ¼ãƒˆã ã£ãŸã€‚ã€ï¼ˆæ„Ÿæƒ³ï¼‰

**Phase B OKé–‹å§‹ä¾‹:**
- ã€Œãµã¨ã€ã€ã€Œã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ã€ã€ã€Œãã®é€”ä¸­ã§ã€ã€

**Phase B NGé–‹å§‹ä¾‹:**
- ã€ŒçœŸæ˜¼ã®çœŒé“ã‚’ã€œã€ï¼ˆPhase A ã®å†æ²ï¼‰
- ã€Œãã®ã‚¢ãƒ‘ãƒ¼ãƒˆã¯ã€œã€ï¼ˆå ´æ‰€ã®å†èª¬æ˜ï¼‰

### Phase C ã®å†…éƒ¨æ§‹é€ 

```
C1: ä¸å¯é€†ç‚¹ã®äº‹å®Ÿæå†™
    ã€Œã‚‚ã†å®‰å…¨ãªè§£é‡ˆãŒæˆã‚Šç«‹ãŸãªã„ã€ã¨èª­è€…ãŒç›´æ„Ÿã™ã‚‹ç¬é–“

C2: çŸ­ã„ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ï¼ˆæ•°æ®µè½ï¼‰
    - ç™»å ´äººç‰©ã®åå¿œï¼ˆãƒ‘ãƒ‹ãƒƒã‚¯/æ··ä¹±/æ±ºæ–­ï¼‰
    - æ€ªç•°ã®é¡•åœ¨åŒ–ï¼ˆè¦‹ãˆã‚‹/èã“ãˆã‚‹/è§¦ã‚Œã‚‹ï¼‰
    - è„±å‡ºã¾ãŸã¯ç”Ÿå­˜ç¢ºèª

ä½™éŸ»: çŠ¶æ³ã‚’å›ºå®šã™ã‚‹çŸ­æ–‡1ã¤ã§ç· ã‚ã‚‹
    ä¾‹ï¼šã€Œã‚ã®éƒ¨å±‹ã®é›»æ°—ã¯ã€ä»Šã‚‚ç‚¹ã„ã¦ã„ã‚‹ã‚‰ã—ã„ã€‚ã€
```

### å“è³ªä¿è¨¼æ©Ÿèƒ½

å„ãƒ•ã‚§ãƒ¼ã‚ºã§ä»¥ä¸‹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€å¤±æ•—æ™‚ã¯è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœ€å¤§2å›ï¼‰ã—ã¾ã™ï¼š

| ãƒã‚§ãƒƒã‚¯é …ç›® | å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ |
|-------------|-------------|------|
| **æ–‡æ•°åˆ¶é™** | Phase A | **1æ–‡ã®ã¿**è¨±å¯ã€‚2æ–‡ä»¥ä¸Šã¯NG â†’ ãƒªãƒˆãƒ©ã‚¤ |
| **ç¦æ­¢èªå¥** | Phase A | æ„Ÿæƒ³/äºˆå‘Š/æœªæ¥è¦–ç‚¹/ä¸ç©ã•/å¿ƒæƒ…æå†™ã‚’æ¤œå‡º â†’ ãƒªãƒˆãƒ©ã‚¤ |
| **é¡ä¼¼åˆ¤å®š** | Phase Aâ†’B | å†’é ­é¡ä¼¼åº¦60%ä»¥ä¸Šã€ç¦æ­¢é–‹å§‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€åŒä¸€ä¸»èªã‚’æ¤œå‡º â†’ ãƒªãƒˆãƒ©ã‚¤ |
| ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å­˜åœ¨ | Phase A | å…¥åŠ›ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæœ¬æ–‡ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ |
| æœªå®Œã‚»ãƒªãƒ•æ¤œå‡º | å…¨ãƒ•ã‚§ãƒ¼ã‚º | ã€Œâ€¦ã€ã€Œâ€•ã€ã§çµ‚ã‚ã‚‹è¨€ã„ã‹ã‘ã®ã‚»ãƒªãƒ•ã‚’æ¤œå‡º |
| å¤šæ§˜æ€§ã‚¬ãƒ¼ãƒ‰ | Phase A | ç›´è¿‘3è©±ã¨é¡ä¼¼ã—ãŸè¨­å®š/ã‚­ãƒ£ã‚¹ãƒˆ/å±•é–‹ã‚’å›é¿ |
| èªå½™ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ | å…¨ãƒ•ã‚§ãƒ¼ã‚º | ç›´è¿‘5è©±ã§é »å‡ºã—ãŸèªå½™ï¼ˆ50ç¨®ä»¥ä¸Šï¼‰ã‚’éæ¨å¥¨ãƒªã‚¹ãƒˆã¨ã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ¸¡ã™ |
| ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é€£å‘¼é˜²æ­¢ | å…¨ãƒ•ã‚§ãƒ¼ã‚º | Phase A=1ã€œ2å›ã€Phase B=æœ€å¤§2å›ã€Phase C=æœ€å¤§1å›ã«åˆ¶é™ |
| å°å…¥æ–‡è¢«ã‚Šãƒã‚§ãƒƒã‚¯ | Phase B | Phase Aã¨åŒã˜å†’é ­æ–‡å‹ï¼ˆã€Œä¿ºãŒã€œã€ç­‰ï¼‰ã§å§‹ã¾ã£ã¦ã„ãªã„ã‹ |
| å‡ºæ¥äº‹å†æå†™ãƒã‚§ãƒƒã‚¯ | Phase B | Phase Aã§èµ·ããŸã‚¤ãƒ™ãƒ³ãƒˆï¼ˆé›»è©±ãŒé³´ã‚‹ç­‰ï¼‰ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãªã„ã‹ |
| è¡Œå‹•æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ | Phase B/C | åŒæ™‚ã«æˆç«‹ã—ãªã„è¡Œå‹•ã‚„å”çªãªé€ƒèµ°ã‚’æ¤œå‡º |
| ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹æ¤œè¨¼ | Phase C | ææ€–ãƒ”ãƒ¼ã‚¯èªå½™ãƒ»ä½™éŸ»æ–‡ã®å­˜åœ¨ã‚’ç¢ºèª |
| ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸»å½¹åŒ– | Phase B+C | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæ€ªç•°ã®æ ¸ã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã‹ |
| é‡è¤‡é™¤å» | é€£çµæ™‚ | Phaseé–“ã®å†’é ­ãƒ†ã‚­ã‚¹ãƒˆé‡è¤‡ã‚’é™¤å»ï¼ˆå…ˆé ­1æ–‡ã®å®Œå…¨ä¸€è‡´/é«˜é¡ä¼¼åº¦ã‚‚æ¤œå‡ºï¼‰ |

## ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

### ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ

```css
/* èƒŒæ™¯ */
--horror-black: #0A0A0A;      /* ãƒ¡ã‚¤ãƒ³èƒŒæ™¯ */
--horror-dark: #121212;       /* ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ */

/* ãƒ†ã‚­ã‚¹ãƒˆ */
--horror-text: #E8E6E3;       /* ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ */
--horror-text-secondary: #9CA3AF; /* ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ†ã‚­ã‚¹ãƒˆ */

/* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
--horror-crimson: #A52A2A;    /* æ·±ç´… */
--horror-red: #8B0000;        /* æš—èµ¤ */
--horror-blood: #4A0000;      /* è¡€ç—•é¢¨ */
```

### ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£

- **ãƒ¡ã‚¤ãƒ³ãƒ•ã‚©ãƒ³ãƒˆ**: Noto Serif JPï¼ˆæ˜æœä½“ï¼‰
- **è‹±æ•°å­—ãƒ•ã‚©ãƒ³ãƒˆ**: Crimson Text, EB Garamond
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: æ¸¸æ˜æœ, YuMincho, serif

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼å¤§ããªå¤‰æ›´ã®å ´åˆã¯ã€ã¾ãšissueã‚’é–‹ã„ã¦å¤‰æ›´å†…å®¹ã‚’è­°è«–ã—ã¦ãã ã•ã„ã€‚

1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add some amazing feature'`)
4. ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ™ è¬è¾

- [Anthropic](https://www.anthropic.com/) - Claude AI
- [Supabase](https://supabase.com/) - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- [Vercel](https://vercel.com/) - ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°
- [Next.js](https://nextjs.org/) - ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

## ğŸ“ ãŠå•ã„åˆã‚ã›

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ³ã‚¯: [https://github.com/Rei-050812/KOWAI](https://github.com/Rei-050812/KOWAI)

---

<div align="center">

**ğŸ•¯ï¸ ææ€–ã®ç¨®ã‚’ã€ç‰©èªã¸ ğŸ•¯ï¸**

Made with â¤ï¸ and ğŸ‘» by Claude Sonnet 4.5

</div>
