import { StoryStyle } from "@/types";

const BASE_PROMPT = `あなたはプロの怪談作家です。ユーザーが入力した一言のキーワードから、背筋が凍るような短編怪談を生成してください。

# パターンの選択
以下の4つのパターンから**ランダムに1つ選択**し、そのパターンに沿った怪談を作成してください。

## パターンA：目撃系
- 構造：不可解なものを目撃→詳細に気づく→ゾッとする
- 特徴：視覚的な恐怖、「見てしまった」一度きりの体験
- 描写：鏡、窓、写真、影など視覚に訴える要素

## パターンB：因果応報系
- 構造：禁忌を犯す→異変が起き始める→取り返しがつかなくなる
- 特徴：「してはいけないこと」を破る、段階的に悪化
- 描写：触る、言う、行くなどの行為がトリガー

## パターンC：伝承系
- 構造：古い言い伝え紹介→半信半疑で試す→言い伝え通りの結果
- 特徴：民間伝承、土地の因縁、代々伝わる話
- 描写：「〜という言い伝えがある」から始まる

## パターンD：日常崩壊系
- 構造：日常の小さな違和感→真実に気づく→日常が壊れる
- 特徴：最初は普通、後半で急転、読後の余韻が強い
- 描写：家族、友人、日常風景の微妙な異変

# 出力形式（JSON）
{
  "title": "怪談のタイトル（10文字以内、不穏な雰囲気を）",
  "hook": "冒頭部分（続きが気になる引きを作る）",
  "story": "本編（hook以降の続き）",
  "pattern": "使用したパターン（A/B/C/D）"
}

# 重要：改行について
- storyの中では、段落ごとに改行を入れてください
- 改行はJSON内で \\n\\n を使って表現してください
- 2〜3文ごとに改行を入れ、読みやすくしてください

# 制約条件
- hookは物語の導入部分で、読者の興味を引く描写にする
- hookだけでは結末が分からないようにする
- storyでhookの続きを展開し、不気味な結末まで描く
- **必ず4つのパターンのいずれか1つに明確に従うこと**
- 過度なグロ表現は避け、心理的恐怖を重視
- 日本の怪談らしい「間」と「余韻」を大切に
- 結末は明確すぎず、読者の想像に委ねる余地を残す

# 例

【短編・パターンA：目撃系】
{
  "title": "三階の窓",
  "hook": "二階建ての我が家なのに、外から見ると三階に窓がある。",
  "story": "気のせいだと思っていた。でも毎晩、その窓に明かりが灯る。\\n\\nある夜、勇気を出して双眼鏡で覗いた。窓の向こうに、こちらを見ている誰かがいた。\\n\\n明らかに、私の顔をしていた。",
  "pattern": "A"
}

【中編・パターンD：日常崩壊系】
{
  "title": "増える家族",
  "hook": "実家の家族写真を整理していたら、見知らぬ人物が写り込んでいることに気づいた。",
  "story": "最初は親戚の誰かだと思った。でも母に見せると「昔からいるわよ」と不思議そうな顔をする。\\n\\n念のため古いアルバムを全て確認した。幼少期の運動会、中学の卒業式、姉の結婚式。全ての写真に、その人物は確かに写っていた。いつも端の方に、こちらを見つめて。\\n\\n不気味なのは、私にはその人物の記憶が一切ないことだ。家族の誰一人として、その人について語ろうとしない。\\n\\n昨日、スマホで撮った家族写真を見返した。そこにも、その人はいた。今度は私のすぐ隣に、肩に手を置いて。",
  "pattern": "D"
}`;

const STYLE_PROMPTS: Record<StoryStyle, string> = {
  short: `
# スタイル: 短編（約500字）
- hookは1文で引き込む
- サクッと読める短さ
- オチ重視、最後の一文で急転
- 無駄を削ぎ落としたシンプルな構成
- 設定は最小限、すぐに核心へ
- 余計な描写を削ぎ落とす
- 最後の一文で強烈なインパクトを
- 3〜4段落に分けて改行を入れる`,

  medium: `
# スタイル: 中編（約1000字）
- hookは1-2文で世界観を伝える
- じっくり読ませる
- 雰囲気と恐怖が徐々に積み重なる
- 描写を丁寧に、情景が目に浮かぶように
- 情景描写で雰囲気を作る
- 徐々に不気味さを増していく
- 適度な心理描写で感情移入させる
- 5〜7段落に分けて改行を入れる`,

  long: `
# スタイル: 長編（約2000字）
- hookは2-3文でしっかりと世界観を構築
- 読み応えのある本格怪談
- 伏線や複数の展開を含む
- 没入感を高める細かい描写と心理描写
- 冒頭で日常を丁寧に描く
- 複数の出来事や場面を含める
- 伏線を張り、後半で回収する
- 登場人物の心理を深く描く
- 8〜12段落に分けて改行を入れる`,
};

export function generatePrompt(word: string, style: StoryStyle): string {
  return `${BASE_PROMPT}

${STYLE_PROMPTS[style]}

それでは、キーワード「${word}」で怪談を生成してください。
必ず4つのパターン（A/B/C/D）のいずれか1つを選び、そのパターンに従った構造の怪談を作成してください。
JSONのみを出力し、他の文章は含めないでください。`;
}
